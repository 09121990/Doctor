WITH DATE_PARAMS AS (
    SELECT 
        TO_DATE('2025-02-01', 'YYYY-MM-DD') AS start_date, 
        TO_DATE('2025-02-28', 'YYYY-MM-DD') AS end_date
    FROM DUAL
),
DATE_RANGE AS (
    SELECT DATE_PARAMS.start_date + LEVEL - 1 AS DATE1
    FROM DATE_PARAMS
    CONNECT BY LEVEL <= DATE_PARAMS.end_date - DATE_PARAMS.start_date + 1
),
PNT AS (
    SELECT 
        DR.DATE1,
        COUNT(DISTINCT PNT.PATID) AS NEW_PATIENT,
        COUNT(DISTINCT RD.PATID) AS Consul_PATIENT,
        COUNT(DISTINCT OPT.PATID) AS PROCE_PATIENT
        
    FROM DATE_RANGE DR
    JOIN LTHMS.PATIENTS PNT 
        ON DR.DATE1 = PNT.REGISDATE
    LEFT JOIN LTHMS.RECEIPTDETAIL RD
        ON TRUNC(RD.RCPTDATE) = DR.DATE1  -- Ensure the date is compared properly
    LEFT JOIN OPTCHARGEDETAIL OPT
        ON TRUNC(OPT.BILLDATE) = DR.DATE1  -- Ensure the date is compared properly 
        
    WHERE LOWER(OPT.RPATTYPE) NOT LIKE '%dhi%'
    GROUP BY DR.DATE1
)
SELECT * 
FROM PNT
ORDER BY DATE1;

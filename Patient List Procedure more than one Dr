--------------------Patient List Procedure more than one Dr

SELECT PATID,
       COUNT(DISTINCT SID) AS Dr_ID,
       LISTAGG(SNAME, ', ') WITHIN GROUP (ORDER BY SNAME) AS Dr_Name
FROM (
    SELECT DISTINCT OCD.PATID, OCD.SID, CP.SNAME
    FROM LTHMS.OPTCHARGEDETAIL OCD
    LEFT JOIN LTHMS.CLINICPERSONNEL CP 
        ON OCD.SID = CP.SID
    WHERE OCD.BILLDATE BETWEEN TO_DATE('2025-01-01', 'YYYY-MM-DD') 
                           AND TO_DATE('2025-01-31', 'YYYY-MM-DD')
)
GROUP BY PATID
HAVING COUNT(DISTINCT SID) > 1; -- Filter patients with more than one doctor

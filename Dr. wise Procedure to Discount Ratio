SELECT
  "CLINICPERSONNEL - SID"."SNAME" "Doctor",
  SUM("LTHMS"."OPTCHARGEDETAIL"."DISCOUNT") "Discount",
  SUM("LTHMS"."OPTCHARGEDETAIL"."AMOUNT") "Amount",
  SUM("LTHMS"."OPTCHARGEDETAIL"."DISCOUNT")/SUM("LTHMS"."OPTCHARGEDETAIL"."AMOUNT") "Ratio of Discount"
FROM
  "LTHMS"."OPTCHARGEDETAIL"
 
LEFT JOIN "LTHMS"."PROCEDURETYPE" "PROCEDURETYPE - RCPTID" ON "LTHMS"."OPTCHARGEDETAIL"."RCPTID" = "PROCEDURETYPE - RCPTID"."PID"
  LEFT JOIN "LTHMS"."CLINICPERSONNEL" "CLINICPERSONNEL - SID" ON "LTHMS"."OPTCHARGEDETAIL"."SID" = "CLINICPERSONNEL - SID"."SID"
WHERE
    1 = 1
   AND (NOT (
        LOWER("LTHMS"."OPTCHARGEDETAIL"."RPATTYPE") LIKE '%dhi%'
      )
     
   
    OR ("LTHMS"."OPTCHARGEDETAIL"."RPATTYPE" IS NULL))
GROUP BY "CLINICPERSONNEL - SID"."SNAME"
ORDER BY "Amount" DESC;
------------------------------------
SELECT
  "CLINICPERSONNEL - SID"."SNAME" "Doctor",
  SUM("LTHMS"."OPTCHARGEDETAIL"."DISCOUNT") "Discount",
  SUM("LTHMS"."OPTCHARGEDETAIL"."AMOUNT") "Amount",
  SUM("LTHMS"."OPTCHARGEDETAIL"."DISCOUNT")/SUM("LTHMS"."OPTCHARGEDETAIL"."AMOUNT") "Ratio of Discount"
FROM
  "LTHMS"."OPTCHARGEDETAIL"
  LEFT JOIN "LTHMS"."PROCEDURETYPE" "PROCEDURETYPE - RCPTID" ON "LTHMS"."OPTCHARGEDETAIL"."RCPTID" = "PROCEDURETYPE - RCPTID"."PID"
  LEFT JOIN "LTHMS"."CLINICPERSONNEL" "CLINICPERSONNEL - SID" ON "LTHMS"."OPTCHARGEDETAIL"."SID" = "CLINICPERSONNEL - SID"."SID"
WHERE
    {{Date}}
AND {{snippet: NOT DHI}}
GROUP BY "CLINICPERSONNEL - SID"."SNAME"
ORDER BY "Amount" DESC
